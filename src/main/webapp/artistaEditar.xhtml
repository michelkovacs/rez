<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<ui:composition template="_template.xhtml">

	<f:metadata>
		<f:viewParam name="artistaId" value="#{artistaBean.artistaId}" />
		<f:viewAction action="#{artistaBean.carregarartistaPeloId}"
			if="#{param.artistaId != null}" />
	</f:metadata>

	<ui:define name="titulo">
				artista
	</ui:define>

	<ui:define name="conteudo">
		<h:form id="artista">
			<p:fieldset legend="Dados do artista">
				<h:panelGrid id="pnlDadosArtista" columns="3">

					<p:outputLabel value="Nome:" for="nome" />
					<p:inputText id="nome" value="#{artistaBean.artista.nome}"
						required="true">
						<f:validateLength minimum="5" />
						<f:ajax event="blur" render="messageNome" />
					</p:inputText>
					<p:message for="nome" id="messageNome" />
					<p:outputLabel for="tipoArtista" value="Tipo Artista:" />
					<p:selectOneMenu id="tipoArtista"
						value="#{artistaBean.artista.tipoArtista}" required="true"
						converter="tipoArtistaConverter"
						requiredMessage="Selecione o tipo de artista" style="width:225px">
						<f:selectItem itemLabel="Selecione o Tipo de Artista" itemValue="" />
						<f:selectItems value="#{artistaBean.tiposArtistas}"
							var="tipoArtista" itemLabel="#{tipoArtista.descricao}"
							itemValue="#{tipoArtista}" />
					</p:selectOneMenu>
					<p:message for="tipoArtista" id="messageTipoArtista" />
					<p:outputLabel value="Estilos:" for="estilos" />
					<p:autoComplete id="estilos" multiple="true"
						value="#{artistaBean.estilosSelecionados}"
						completeMethod="#{artistaBean.filtrarEstilos}" var="estilo"
						itemLabel="#{estilo.nome}" itemValue="#{estilo}"
						converter="estiloConverter" forceSelection="true">
						<p:column>
							<h:outputText value="#{estilo.nome}" />
						</p:column>
					</p:autoComplete>
					<p:spacer></p:spacer>
					<p:outputLabel value="Possui trabalho autoral?" for="descricao" />
					<p:inputSwitch value="#{artistaBean.artista.autoral}" onLabel="SIM"
						offLabel="NÃO" />
					<p:spacer></p:spacer>
					<p:outputLabel value="Descrição:" for="descricao" />
					<p:inputTextarea id="descricao" rows="8" cols="100"
						value="#{artistaBean.artista.descricao}" />
					<p:spacer></p:spacer>
					<p:commandButton value="Gravar" action="#{artistaBean.gravar}"
						process="pnlDadosArtista" update="@form" />
				</h:panelGrid>
			</p:fieldset>
			<p:fieldset legend="Vídeos">
				<h:panelGrid id="pnlAdicionaVideo" columns="4">
					<p:outputLabel value="Título do vídeo:" for="urlYoutube" />
					<p:inputText id="tituloMidia" value="#{artistaBean.tituloMidia}">
						<f:validateLength maximum="50"></f:validateLength>
					</p:inputText>
					<p:outputLabel value="Endereço vídeo youtube:" for="urlYoutube" />
					<p:inputText id="urlYoutube" value="#{artistaBean.urlYoutube}">
						<f:validator validatorId="YouTubeValidator"></f:validator>
						<f:validateLength maximum="150"></f:validateLength>
					</p:inputText>
					<p:commandButton value="adicionar"
						action="#{artistaBean.adicionarUrlVideo}"
						process="pnlAdicionaVideo" update="listaVideos pnlAdicionaVideo">
					</p:commandButton>
					<p:message for="urlYoutube"></p:message>
				</h:panelGrid>
			</p:fieldset>
			<p:dataList id="listaVideos" itemType="none"
				value="#{artistaBean.artista.midias}" var="midia" type="unordered">
				<f:facet name="header">
            		Vídeos
       		 	</f:facet>
				<p:commandLink title="remover vídeo"
					action="#{artistaBean.removerVideo(midia)}" process="@this"
					update="listaVideos" styleClass="ui-icon ui-icon-trash"
					style="float:left;margin-right:10px">
				</p:commandLink>
				<h:outputText value="#{midia.titulo}" style="display:inline-block" />
					-
				<h:outputText value="#{midia.url}" style="display:inline-block" />
			</p:dataList>
			<p:fieldset legend="Incluir novas fotos">
				<p:fileUpload fileUploadListener="#{artistaBean.handleFileUpload}"
					label="escolher arquivo"
					mode="advanced" dragDropSupport="false" update="msgUploadFoto"
					cancelLabel="cancelar" uploadLabel="enviar" 
					sizeLimit="1000000" fileLimit="5"
					allowTypes="/(\.|\/)(jpe?g)$/" />

			</p:fieldset>
			<p:growl id="msgUploadFoto" showDetail="true" />

			<p:galleria rendered="false" value="#{artistaBean.artista.fotos}" var="foto"
				panelWidth="500" panelHeight="313" showCaption="false">
				<p:graphicImage value="#{fotoArtistaBean.fotoArtista}" title=" ">
					<f:param name="fotoArtistaUniqueId" value="#{foto.uniqueId}" />
				</p:graphicImage>
				<p:commandButton value="definir como principal"
					action="#{artistaBean.definirFotoPrincipal(foto)}" process="@all"
					update="@all"></p:commandButton>
			</p:galleria>
			<p:dataGrid var="foto" value="#{artistaBean.artista.fotos}"
				columns="3" layout="grid" rows="12" paginator="false" id="gridFotos"
				paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
				rowsPerPageTemplate="6,12,16">

				<f:facet name="header">
            		Fotos
        		</f:facet>

				<p:panel header="foto" style="text-align:center">
					<h:panelGrid columns="1" style="width:100%">
						<p:graphicImage width="360" height="220" value="#{fotoArtistaBean.fotoArtista}" title=" ">
							<f:param name="fotoArtistaUniqueId" value="#{foto.uniqueId}" />
						</p:graphicImage>
						<p:commandButton rendered="#{foto.principal == false}" value="definir como principal"
							action="#{artistaBean.definirFotoPrincipal(foto)}" process="@all" immediate="true"
							update="@all"></p:commandButton>
					</h:panelGrid>
				</p:panel>


			</p:dataGrid>

		</h:form>

	</ui:define>

</ui:composition>

</html>